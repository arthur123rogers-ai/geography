<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geography Liveability & Environment App</title>
  <style>
    :root {
      --primary: #2b7a78;
      --secondary: #def2f1;
      --accent: #fe8a71;
      --text: #17252a;
      --card-bg: #ffffff;
      --muted: #52616b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #f8f9fb 0%, #e7f2f3 100%);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      background: var(--primary);
      color: #fff;
      padding: 1.2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    h1 {
      margin: 0 0 0.5rem 0;
      font-size: 1.6rem;
    }

    nav {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    nav a {
      color: #fff;
      text-decoration: none;
      background: rgba(255, 255, 255, 0.15);
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      transition: background 0.2s ease;
    }

    nav a:hover, nav a:focus {
      background: rgba(255, 255, 255, 0.3);
    }

    main {
      max-width: 1100px;
      margin: 1.5rem auto 3rem auto;
      padding: 0 1rem;
    }

    section {
      background: var(--card-bg);
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
      border: 1px solid #e2e8f0;
    }

    h2 {
      margin-top: 0;
      color: var(--primary);
    }

    .grid {
      display: grid;
      gap: 1rem;
    }

    .two-col {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.3rem;
      color: var(--muted);
    }

    input[type="number"], select {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #cfd8dc;
      border-radius: 8px;
      font-size: 1rem;
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.75rem 1.2rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.4px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
    }

    button:hover, button:focus {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      background: #236c65;
    }

    .muted {
      color: var(--muted);
    }

    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .info-card {
      background: #f8fbff;
      border: 1px solid #dfe9f3;
      border-radius: 12px;
      padding: 1rem;
    }

    .result-box, .quiz-box, .battle-box {
      background: #f8fbff;
      border: 1px solid #dce5ec;
      padding: 1rem;
      border-radius: 12px;
      margin-top: 1rem;
    }

    .rating-label {
      display: inline-block;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      font-weight: 700;
      color: #fff;
    }

    .label-high { background: #2ecc71; }
    .label-liveable { background: #3498db; }
    .label-challenging { background: #f39c12; }
    .label-hard { background: #e74c3c; }

    .city-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
    }

    .city-card {
      border: 1px solid #e1e7ed;
      border-radius: 12px;
      padding: 0.9rem;
      background: #fff;
    }

    .city-card h4 {
      margin: 0 0 0.4rem 0;
    }

    .pill {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: #eef7f6;
      margin-right: 0.25rem;
      font-size: 0.85rem;
      color: var(--primary);
    }

    .score {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary);
    }

    .battle-summary {
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid #e2e8f0;
    }

    .flex {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .small {
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Geography Liveability & Environment App</h1>
    <nav>
      <a href="#calculator">Calculator</a>
      <a href="#environment">Environment</a>
      <a href="#quiz">Quiz</a>
      <a href="#battle">City Battle</a>
    </nav>
  </header>

  <main>
    <section id="calculator">
      <h2>Liveability Calculator (EIU-style)</h2>
      <p class="muted">Enter scores for each category (0-100). The app averages them to estimate a liveability score.</p>
      <div class="grid two-col">
        <div>
          <label for="stability">Stability</label>
          <input type="number" id="stability" min="0" max="100" value="70" />
          <label for="healthcare">Healthcare</label>
          <input type="number" id="healthcare" min="0" max="100" value="72" />
          <label for="cultureEnv">Culture &amp; Environment</label>
          <input type="number" id="cultureEnv" min="0" max="100" value="75" />
        </div>
        <div>
          <label for="education">Education</label>
          <input type="number" id="education" min="0" max="100" value="74" />
          <label for="infrastructure">Infrastructure</label>
          <input type="number" id="infrastructure" min="0" max="100" value="73" />
          <label for="sampleCity">Sample Cities</label>
          <select id="sampleCity"></select>
        </div>
      </div>
      <div class="flex" style="margin-top: 1rem;">
        <button id="calculateBtn">Calculate Liveability</button>
        <span class="muted small">Tip: pick a sample city to auto-fill and compare.</span>
      </div>
      <div class="result-box" id="calcResult"></div>
    </section>

    <section id="environment">
      <h2>Environment &amp; Liveability</h2>
      <p class="muted">Better environments often make cities calmer, healthier, and more enjoyable to live in. These cards use simple Year 7 language.</p>
      <div class="card-list">
        <div class="info-card">
          <h3>Air Quality</h3>
          <p>Clean air means fewer breathing problems and more outdoor play. Reducing traffic smoke and factory fumes keeps skies clearer.</p>
          <ul>
            <li>Track pollution index.</li>
            <li>Encourage cycling and walking.</li>
            <li>Plant street trees.</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>Green Space</h3>
          <p>Parks and gardens cool a city and give people places to relax. A city with many trees usually feels calmer and safer.</p>
          <ul>
            <li>Count parks per neighbourhood.</li>
            <li>Shade from trees lowers summer heat.</li>
            <li>Birds and insects thrive.</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>Water Quality</h3>
          <p>Healthy rivers and clean drinking water stop sickness. Wetlands can filter dirty water and reduce floods.</p>
          <ul>
            <li>Check tap water safety.</li>
            <li>Protect river banks.</li>
            <li>Keep plastics out of drains.</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>Climate &amp; Weather</h3>
          <p>Milder climates feel comfortable. Extreme heat or storms can lower liveability, so cities plan shade, shelters, and cooling centres.</p>
          <ul>
            <li>Track heatwave days.</li>
            <li>Have storm-safe buildings.</li>
            <li>Use light roofs to reflect heat.</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>Transport &amp; Pollution</h3>
          <p>Buses, trains, and bike lanes cut car trips, which lowers air pollution. Good transport also helps people reach jobs and schools.</p>
          <ul>
            <li>Measure public transport access.</li>
            <li>Limit traffic jams near schools.</li>
            <li>Support electric vehicles.</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>Sustainable Cities</h3>
          <p>Saving energy and recycling keeps resources for the future. Efficient buildings and clean power make cities both greener and more liveable.</p>
          <ul>
            <li>Use solar where possible.</li>
            <li>Recycle and reuse materials.</li>
            <li>Protect local wildlife habitats.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="quiz">
      <h2>Liveability &amp; Environment Quiz</h2>
      <p class="muted">Test your knowledge about EIU-style categories, environment, and what makes cities liveable.</p>
      <button id="startQuiz">Start Liveability &amp; Environment Quiz</button>
      <div class="quiz-box" id="quizBox" aria-live="polite"></div>
    </section>

    <section id="battle">
      <h2>City Battle</h2>
      <p class="muted">Draft three cities, battle a bot, and watch ratings fluctuate after every match.</p>
      <div class="city-list" id="cityList"></div>
      <div class="flex" style="margin-top: 1rem;">
        <button id="battleBtn">Start Battle</button>
        <span class="muted small">Pick exactly three cities for your team. The bot drafts from the rest.</span>
      </div>
      <div class="battle-box" id="battleResult"></div>
    </section>
  </main>

  <script>
    // --- Data for sample cities and default categories ---
    const sampleCities = [
      { name: "Coastville", stability: 85, healthcare: 90, cultureEnv: 88, education: 80, infrastructure: 82 },
      { name: "Riverport", stability: 75, healthcare: 70, cultureEnv: 72, education: 78, infrastructure: 76 },
      { name: "Desert City", stability: 60, healthcare: 55, cultureEnv: 50, education: 58, infrastructure: 62 },
      { name: "Mountain Ridge", stability: 82, healthcare: 78, cultureEnv: 85, education: 74, infrastructure: 79 },
      { name: "Forest Glen", stability: 68, healthcare: 71, cultureEnv: 77, education: 69, infrastructure: 70 }
    ];

    // Populate sample city dropdown on load
    const sampleSelect = document.getElementById('sampleCity');
    sampleCities.forEach((city, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.textContent = city.name;
      sampleSelect.appendChild(option);
    });

    // Auto-fill form when a sample city is chosen
    sampleSelect.addEventListener('change', (e) => {
      const city = sampleCities[e.target.value];
      if (!city) return;
      document.getElementById('stability').value = city.stability;
      document.getElementById('healthcare').value = city.healthcare;
      document.getElementById('cultureEnv').value = city.cultureEnv;
      document.getElementById('education').value = city.education;
      document.getElementById('infrastructure').value = city.infrastructure;
      calculateLiveability();
    });

    // Helper to determine rating label based on score
    function getRatingLabel(score) {
      if (score >= 80) return { text: 'Highly liveable', className: 'label-high' };
      if (score >= 60) return { text: 'Liveable', className: 'label-liveable' };
      if (score >= 40) return { text: 'Challenging', className: 'label-challenging' };
      return { text: 'Very difficult to live in', className: 'label-hard' };
    }

    // Calculate average liveability score from five categories
    function calculateLiveability() {
      const fields = ['stability', 'healthcare', 'cultureEnv', 'education', 'infrastructure'];
      const values = [];

      for (const field of fields) {
        const val = Number(document.getElementById(field).value);
        if (Number.isNaN(val) || val < 0 || val > 100) {
          document.getElementById('calcResult').innerHTML = '<p>Please enter numbers between 0 and 100 for all categories.</p>';
          return;
        }
        values.push(val);
      }

      // Average score across all five categories
      const totalScore = values.reduce((sum, v) => sum + v, 0) / values.length;
      const label = getRatingLabel(totalScore);

      // Explanation to help students interpret the score
      let explanation = '';
      if (totalScore >= 80) {
        explanation = 'This city scores well across most categories. Residents likely feel safe, have strong services, and enjoy a clean environment.';
      } else if (totalScore >= 60) {
        explanation = 'The city is generally comfortable. It may have a few weak spots, but daily life is mostly smooth.';
      } else if (totalScore >= 40) {
        explanation = 'Life here might feel unpredictable. Improving transport, healthcare, or safety could raise the score.';
      } else {
        explanation = 'Many services are limited. Investments in health, safety, and infrastructure are needed to lift liveability.';
      }

      // Compare to selected sample city
      const selected = sampleCities[sampleSelect.value] || sampleCities[0];
      const sampleScore = (
        selected.stability + selected.healthcare + selected.cultureEnv + selected.education + selected.infrastructure
      ) / 5;
      const difference = (totalScore - sampleScore).toFixed(1);
      const comparison = difference >= 0
        ? `Your city is more liveable than ${selected.name} by ${difference} points.`
        : `Your city is less liveable than ${selected.name} by ${Math.abs(difference)} points.`;

      document.getElementById('calcResult').innerHTML = `
        <div class="flex">
          <div class="rating-label ${label.className}">${label.text}</div>
          <div class="score">Total score: ${totalScore.toFixed(1)} / 100</div>
        </div>
        <p>${explanation}</p>
        <p>Your city score: ${totalScore.toFixed(1)} | ${selected.name} score: ${sampleScore.toFixed(1)}</p>
        <p>${comparison}</p>
      `;
    }

    document.getElementById('calculateBtn').addEventListener('click', calculateLiveability);

    // --- Quiz logic ---
    const quizQuestions = [
      {
        question: 'What does liveability measure?',
        options: [
          'How rich a country is',
          'How safe and comfortable life is in a city',
          'How tall buildings are',
          'How many tourist spots a city has'
        ],
        answer: 1,
        explanation: 'Liveability checks daily comfort: safety, services, and environment.'
      },
      {
        question: 'Which factor best improves air quality?',
        options: [
          'More diesel cars',
          'Planting trees and reducing traffic smoke',
          'Building taller skyscrapers',
          'Adding more billboards'
        ],
        answer: 1,
        explanation: 'Trees absorb pollution and fewer car fumes mean cleaner air.'
      },
      {
        question: 'Which category fits public hospitals?',
        options: ['Stability', 'Healthcare', 'Education', 'Infrastructure'],
        answer: 1,
        explanation: 'Hospitals support the Healthcare category in EIU-style rankings.'
      },
      {
        question: 'Liveability vs wealth: which is true?',
        options: [
          'Wealth always guarantees high liveability',
          'Wealth is the only liveability measure',
          'Liveability focuses on quality of life, not just money',
          'Liveability ignores environment'
        ],
        answer: 2,
        explanation: 'Liveability looks at safety, services, and environment, not only income.'
      },
      {
        question: 'Air pollution belongs to which category?',
        options: ['Stability', 'Healthcare', 'Culture & Environment', 'Infrastructure'],
        answer: 2,
        explanation: 'Environment and culture scores include air and green space quality.'
      },
      {
        question: 'Which action makes a city more sustainable?',
        options: ['Wasting electricity', 'Recycling and saving energy', 'Leaving parks empty', 'Removing bike lanes'],
        answer: 1,
        explanation: 'Saving energy and recycling protect resources for the future.'
      },
      {
        question: 'What helps people reach jobs and school more easily?',
        options: ['Crowded roads', 'Few buses', 'Reliable public transport', 'Closing stations'],
        answer: 2,
        explanation: 'Good transport raises convenience and cuts pollution.'
      },
      {
        question: 'Which city feature cools hot streets?',
        options: ['Metal roofs', 'Concrete-only parks', 'Shade trees and green roofs', 'Removing gardens'],
        answer: 2,
        explanation: 'Trees and plants provide shade and lower temperatures.'
      }
    ];

    let currentQuestion = 0;
    let score = 0;

    const quizBox = document.getElementById('quizBox');
    function renderQuestion() {
      const q = quizQuestions[currentQuestion];
      quizBox.innerHTML = `
        <p><strong>Question ${currentQuestion + 1} of ${quizQuestions.length}:</strong> ${q.question}</p>
        <div class="grid" style="gap: 0.5rem;">
          ${q.options.map((opt, idx) => `
            <button class="quiz-option" data-index="${idx}">${opt}</button>
          `).join('')}
        </div>
      `;
      document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => handleAnswer(Number(btn.dataset.index)));
      });
    }

    function handleAnswer(selectedIndex) {
      const q = quizQuestions[currentQuestion];
      const correct = selectedIndex === q.answer;
      if (correct) score++;

      quizBox.innerHTML = `
        <p><strong>${correct ? 'Correct!' : 'Incorrect.'}</strong> ${q.explanation}</p>
        <button id="nextQuestion">${currentQuestion === quizQuestions.length - 1 ? 'See Results' : 'Next Question'}</button>
      `;

      document.getElementById('nextQuestion').addEventListener('click', () => {
        currentQuestion++;
        if (currentQuestion < quizQuestions.length) {
          renderQuestion();
        } else {
          renderQuizResults();
        }
      });
    }

    function renderQuizResults() {
      const message = score >= quizQuestions.length * 0.75
        ? 'Liveability Legend! You really understand what makes cities tick.'
        : 'Keep practising! Explore how environment and services shape daily life.';
      quizBox.innerHTML = `
        <p><strong>Final score:</strong> ${score} / ${quizQuestions.length}</p>
        <p>${message}</p>
        <button id="restartQuiz">Restart Quiz</button>
      `;
      document.getElementById('restartQuiz').addEventListener('click', startQuiz);
    }

    function startQuiz() {
      currentQuestion = 0;
      score = 0;
      renderQuestion();
    }

    document.getElementById('startQuiz').addEventListener('click', startQuiz);

    // --- City Battle logic ---
    const cities = [
      { name: 'Coastville', stability: 85, healthcare: 90, cultureEnv: 88, education: 80, infrastructure: 82, rating: 1500 },
      { name: 'Riverport', stability: 75, healthcare: 70, cultureEnv: 72, education: 78, infrastructure: 76, rating: 1450 },
      { name: 'Desert City', stability: 60, healthcare: 55, cultureEnv: 50, education: 58, infrastructure: 62, rating: 1420 },
      { name: 'Mountain Ridge', stability: 82, healthcare: 78, cultureEnv: 85, education: 74, infrastructure: 79, rating: 1490 },
      { name: 'Forest Glen', stability: 68, healthcare: 71, cultureEnv: 77, education: 69, infrastructure: 70, rating: 1440 },
      { name: 'Harborview', stability: 80, healthcare: 82, cultureEnv: 79, education: 81, infrastructure: 83, rating: 1480 },
      { name: 'Lakeside', stability: 73, healthcare: 76, cultureEnv: 74, education: 77, infrastructure: 75, rating: 1460 },
      { name: 'Sunset Plains', stability: 65, healthcare: 68, cultureEnv: 69, education: 64, infrastructure: 66, rating: 1430 }
    ];

    const cityList = document.getElementById('cityList');
    function cityOverall(city) {
      return (city.stability + city.healthcare + city.cultureEnv + city.education + city.infrastructure) / 5;
    }

    function renderCities() {
      cityList.innerHTML = cities.map((city, index) => `
        <div class="city-card">
          <div class="flex" style="justify-content: space-between; align-items: center;">
            <h4>${city.name}</h4>
            <input type="checkbox" class="city-pick" data-index="${index}" aria-label="Select ${city.name}">
          </div>
          <p class="score">Rating: ${city.rating}</p>
          <div class="flex small">
            <span class="pill">Avg: ${cityOverall(city).toFixed(1)}</span>
            <span class="pill">Stability ${city.stability}</span>
            <span class="pill">Health ${city.healthcare}</span>
            <span class="pill">Culture/Env ${city.cultureEnv}</span>
          </div>
        </div>
      `).join('');
    }

    renderCities();

    function pickUserTeam() {
      const selected = Array.from(document.querySelectorAll('.city-pick:checked')).map(cb => Number(cb.dataset.index));
      if (selected.length !== 3) {
        alert('Please pick exactly three cities for your team.');
        return null;
      }
      return selected.map(i => cities[i]);
    }

    function pickBotTeam(userIndexes) {
      const remaining = cities.filter((_, idx) => !userIndexes.includes(idx));
      // Shuffle remaining and take first three
      for (let i = remaining.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [remaining[i], remaining[j]] = [remaining[j], remaining[i]];
      }
      return remaining.slice(0, 3);
    }

    function teamScore(team) {
      // Team score is the sum of each city's average category score with a tiny random factor
      return team.reduce((sum, city) => sum + cityOverall(city), 0) + Math.random() * 5;
    }

    function adjustRatings(userTeam, botTeam, outcome) {
      const changeWin = 15;
      const changeLose = -12;
      const changeDraw = 3;
      const summary = [];

      if (outcome === 'win') {
        userTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeWin}`); city.rating += changeWin; });
        botTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeLose}`); city.rating += changeLose; });
      } else if (outcome === 'lose') {
        userTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeLose}`); city.rating += changeLose; });
        botTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeWin}`); city.rating += changeWin; });
      } else {
        userTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeDraw}`); city.rating += changeDraw; });
        botTeam.forEach(city => { summary.push(`${city.name}: ${city.rating} → ${city.rating + changeDraw}`); city.rating += changeDraw; });
      }
      return summary;
    }

    document.getElementById('battleBtn').addEventListener('click', () => {
      const userIndexes = Array.from(document.querySelectorAll('.city-pick:checked')).map(cb => Number(cb.dataset.index));
      const userTeam = pickUserTeam();
      if (!userTeam) return;
      const botTeam = pickBotTeam(userIndexes);

      const userScore = teamScore(userTeam);
      const botScore = teamScore(botTeam);
      let outcome = 'draw';
      let winnerText = 'Draw! Both teams were evenly matched.';

      if (userScore > botScore + 0.5) {
        outcome = 'win';
        winnerText = 'You win! Your draft delivered higher liveability.';
      } else if (botScore > userScore + 0.5) {
        outcome = 'lose';
        winnerText = 'Bot wins! Try picking different strengths next time.';
      }

      // Adjust ratings based on outcome
      const ratingChanges = adjustRatings(userTeam, botTeam, outcome);
      renderCities();

      document.getElementById('battleResult').innerHTML = `
        <p><strong>${winnerText}</strong></p>
        <p>Your team score: ${userScore.toFixed(1)} | Bot team score: ${botScore.toFixed(1)}</p>
        <div class="battle-summary">
          <p><strong>Rating changes:</strong></p>
          <ul>${ratingChanges.map(change => `<li>${change}</li>`).join('')}</ul>
        </div>
      `;
    });

    // Calculate once at start to show initial results
    calculateLiveability();
  </script>
</body>
</html>
